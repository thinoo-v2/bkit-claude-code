# v1.4.4 Skills/Agents/Commands Enhancement Design Document

> **Summary**: Skills 중심 아키텍처로 전환하여 Commands/Skills 이중 구조 제거 및 유기적 연동 강화
>
> **Project**: bkit-claude-code
> **Version**: v1.4.4
> **Author**: Claude Opus 4.5
> **Date**: 2026-01-27
> **Status**: Draft
> **Planning Doc**: [v1.4.4-skills-agents-commands-enhancement.plan.md](../../01-plan/features/v1.4.4-skills-agents-commands-enhancement.plan.md)

### Related Analysis

| Document | Status |
|----------|--------|
| [Gap Analysis](../../03-analysis/v1.4.4-gap-analysis-10-perspectives.md) | ✅ Completed |
| [Plan Document](../../01-plan/features/v1.4.4-skills-agents-commands-enhancement.plan.md) | ✅ Completed |

---

## 1. Overview

### 1.1 Design Goals

1. **Commands → Skills 완전 통합**: 20개 Commands를 Skills로 흡수하여 단일 인터페이스 제공
2. **Skills-Templates 자동 연동**: @import 지시어를 통한 템플릿 자동 로딩
3. **Skill Orchestrator**: Skills 호출 시 Task/PDCA/Agent 자동 연동
4. **유기적 워크플로우**: Stop Hooks를 통한 다음 단계 자동 제안

### 1.2 Design Principles

- **Skills First**: 모든 사용자 기능은 Skills로 제공 (Commands 대신)
- **Organic Integration**: Skills-Agents-Task-Templates 자동 연동
- **Philosophy Compliance**: Automation First, No Guessing, Docs=Code 완전 구현
- **Backward Compatible**: 기존 Commands는 deprecation 기간 동안 Skills로 리다이렉트

---

## 2. Architecture

### 2.1 Component Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                     User Input (Chat/Command)                     │
└─────────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                    UserPromptSubmit Hook                          │
│  - Skill 트리거 감지 (matchImplicitSkillTrigger)                  │
│  - Agent 트리거 감지 (matchImplicitAgentTrigger)                  │
│  - 신규 기능 감지 (detectNewFeatureIntent)                        │
└─────────────────────────────────────────────────────────────────┘
                                   │
              ┌────────────────────┼────────────────────┐
              ▼                    ▼                    ▼
┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐
│   Skill System   │  │   Agent System   │  │   Task System    │
│                  │  │                  │  │                  │
│ ┌──────────────┐ │  │ • gap-detector   │  │ • TaskCreate     │
│ │   PDCA       │ │  │ • pdca-iterator  │  │ • TaskUpdate     │
│ │   Skill      │◀┼──┤ • code-analyzer  │  │ • TaskList       │
│ │  (통합)      │ │  │ • report-gen     │  │ • TaskGet        │
│ └──────────────┘ │  │ • starter-guide  │  └──────────────────┘
│                  │  │ • design-valid   │           │
│ ┌──────────────┐ │  │ • qa-monitor     │           │
│ │  Pipeline    │ │  │ • pipeline-guide │           │
│ │   Skill      │◀┼──┤ • bkend-expert   │           │
│ │  (확장)      │ │  │ • enterprise-exp │           │
│ └──────────────┘ │  │ • infra-architect│           │
│                  │  └──────────────────┘           │
│ ┌──────────────┐ │           │                     │
│ │Level Skills  │ │           │                     │
│ │starter/dyn/  │ │           │                     │
│ │enterprise    │ │           │                     │
│ └──────────────┘ │           │                     │
└──────────────────┘           │                     │
          │                    │                     │
          ▼                    ▼                     ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Skill Orchestrator (신규)                      │
│  - Template 자동 로드 (@import)                                   │
│  - Task 자동 생성/업데이트                                        │
│  - PDCA 상태 자동 관리 (.bkit-memory.json)                        │
│  - 다음 단계 자동 제안                                            │
└─────────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Stop Hooks                                 │
│  - PostToolUse(Skill) → skill-post.js                            │
│  - Agent Stop → 각 agent별 stop script                            │
│  - AskUserQuestion 기반 다음 단계 제안                            │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 Data Flow

```
┌───────────────────────────────────────────────────────────────────────────┐
│                           Skill 호출 데이터 흐름                           │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  1. Skill Tool 호출                                                       │
│     │                                                                     │
│     ├──→ YAML Frontmatter 파싱                                            │
│     │    • name, description                                              │
│     │    • imports (템플릿 경로)                                          │
│     │    • agent (연결된 Agent)                                           │
│     │    • hooks (Stop 등)                                                │
│     │    • allowed-tools                                                  │
│     │    ★ 신규: next-skill, pdca-phase, task-template                   │
│     │                                                                     │
│     ├──→ Import Resolver 실행                                             │
│     │    • ${PLUGIN_ROOT} 변수 치환                                       │
│     │    • 템플릿 파일 로드                                               │
│     │    • 조건부 imports 처리                                            │
│     │                                                                     │
│     ├──→ Skill Orchestrator 실행 (신규)                                   │
│     │    • Task 자동 생성 (task-template 필드 기반)                       │
│     │    • PDCA 상태 업데이트 (pdca-phase 필드 기반)                      │
│     │    • 연결된 Agent 사전 로드 (skills_preload)                        │
│     │                                                                     │
│     └──→ Skill Body 실행                                                  │
│          • Markdown 내용 컨텍스트로 전달                                  │
│          • 로드된 템플릿 참조 가능                                        │
│                                                                           │
│  2. Skill 완료 (Stop Hook)                                                │
│     │                                                                     │
│     ├──→ skill-post.js 실행                                               │
│     │    • Task 상태 업데이트 (completed)                                 │
│     │    • PDCA 상태 업데이트                                             │
│     │    • .bkit-memory.json 저장                                         │
│     │                                                                     │
│     └──→ 다음 단계 제안                                                   │
│          • next-skill 필드 기반                                           │
│          • AskUserQuestion으로 사용자 확인                                │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

### 2.3 Dependencies

| Component | Depends On | Purpose |
|-----------|-----------|---------|
| Skill Orchestrator | import-resolver.js | 템플릿 @import 처리 |
| Skill Orchestrator | common.js | Task/PDCA 유틸리티 |
| skill-post.js | .bkit-memory.json | PDCA 상태 저장 |
| PDCA Skill | 모든 PDCA 템플릿 | 문서 생성 |
| Agent Stop Hooks | Skill Orchestrator | 다음 단계 제안 |

---

## 3. Data Model

### 3.1 Skill Frontmatter 확장 스키마

```yaml
# 기존 필드 (유지)
name: string                    # Skill 이름
description: string             # 설명 (트리거 키워드 포함)
imports: string[]               # 로드할 템플릿 경로
agent: string                   # 연결된 Agent (optional)
allowed-tools: string[]         # 허용된 도구 목록
user-invocable: boolean         # 사용자 직접 호출 가능 여부
hooks:                          # Hook 정의
  Stop: HookConfig[]
  PreToolUse: HookConfig[]
  PostToolUse: HookConfig[]

# 신규 필드 (v1.4.4)
argument-hint: string           # 인자 힌트 (예: "[action] [feature]")
next-skill: string              # 완료 후 제안할 다음 Skill
pdca-phase: string              # PDCA 단계 (plan, design, do, check, act)
task-template: string           # Task 생성 템플릿 (예: "[Plan] {feature}")
skills_preload: string[]        # 사전 로드할 Skill 목록
```

### 3.2 .bkit-memory.json 확장

```json
{
  "version": "1.4.4",
  "currentFeature": "feature-name",
  "pdcaStatus": {
    "phase": "do",
    "planPath": "docs/01-plan/features/feature.plan.md",
    "designPath": "docs/02-design/features/feature.design.md",
    "lastUpdated": "2026-01-27T10:00:00Z"
  },
  "pipelineStatus": {
    "currentPhase": 4,
    "completedPhases": [1, 2, 3],
    "level": "dynamic"
  },
  "taskMapping": {
    "plan": "task-id-1",
    "design": "task-id-2",
    "do": "task-id-3",
    "check": null,
    "act": null
  },
  "skillHistory": [
    {
      "skill": "pdca",
      "action": "plan",
      "timestamp": "2026-01-27T09:00:00Z"
    }
  ]
}
```

### 3.3 Hook Output 스키마

```json
// skill-post.js 출력
{
  "continue": true,
  "message": "Plan 문서가 생성되었습니다. Design 단계로 진행하시겠습니까?",
  "suggestedAction": {
    "type": "skill",
    "name": "pdca",
    "args": "design feature-name"
  },
  "taskUpdate": {
    "taskId": "task-id",
    "status": "completed"
  },
  "pdcaUpdate": {
    "phase": "design",
    "feature": "feature-name"
  }
}
```

---

## 4. Module Specifications

### 4.1 PDCA Skill 상세 설계

#### 4.1.1 Frontmatter

```yaml
# skills/pdca/SKILL.md
---
name: pdca
description: |
  PDCA 사이클 전체를 관리하는 통합 skill.
  "계획", "설계", "분석", "보고서", "상태" 키워드로 자동 호출.
  기존 /pdca-* 명령어를 대체.

  Triggers: pdca, 계획, 설계, 분석, 검증, 보고서, plan, design, analyze,
  check, report, status, next, iterate, 計画, 設計, 分析, 计划, 设计

  Do NOT use for: simple queries without PDCA context.
argument-hint: "[action] [feature]"
user-invocable: true
allowed-tools:
  - Read
  - Write
  - Edit
  - Glob
  - Grep
  - Task
  - TaskCreate
  - TaskUpdate
imports:
  - ${PLUGIN_ROOT}/templates/plan.template.md
  - ${PLUGIN_ROOT}/templates/design.template.md
  - ${PLUGIN_ROOT}/templates/analysis.template.md
  - ${PLUGIN_ROOT}/templates/report.template.md
  - ${PLUGIN_ROOT}/templates/do.template.md
hooks:
  Stop:
    - matcher: ".*"
      hooks:
        - type: command
          command: "node ${CLAUDE_PLUGIN_ROOT}/scripts/pdca-skill-stop.js"
          timeout: 10000
---
```

#### 4.1.2 Body 구조

```markdown
# PDCA Skill

## Arguments

| Argument | Description | Example |
|----------|-------------|---------|
| `plan [feature]` | Plan 문서 생성 | `/pdca plan user-auth` |
| `design [feature]` | Design 문서 생성 | `/pdca design user-auth` |
| `do [feature]` | Do 단계 가이드 | `/pdca do user-auth` |
| `analyze [feature]` | Gap 분석 실행 | `/pdca analyze user-auth` |
| `iterate [feature]` | 자동 개선 반복 | `/pdca iterate user-auth` |
| `report [feature]` | 완료 보고서 생성 | `/pdca report user-auth` |
| `status` | 현재 PDCA 상태 표시 | `/pdca status` |
| `next` | 다음 단계 가이드 | `/pdca next` |

## Action별 동작

### plan
1. `docs/01-plan/features/{feature}.plan.md` 존재 여부 확인
2. 없으면 plan.template.md 기반으로 생성
3. 있으면 내용 표시 및 수정 제안
4. Task 생성: `[Plan] {feature}`

### design
1. Plan 문서 존재 확인 (필수)
2. `docs/02-design/features/{feature}.design.md` 생성
3. Task 생성: `[Design] {feature}` (blockedBy: Plan task)

### do
1. Design 문서 존재 확인 (필수)
2. do.template.md 기반 구현 가이드 제공
3. Task 생성: `[Do] {feature}` (blockedBy: Design task)

### analyze (gap-detector Agent 호출)
1. Do 완료 상태 확인
2. gap-detector Agent 호출
3. 분석 결과 기반 Act 제안

### iterate (pdca-iterator Agent 호출)
1. Check 결과 확인 (< 90% 시)
2. pdca-iterator Agent 호출
3. 자동 개선 반복

### report
1. Check >= 90% 확인
2. report-generator Agent 호출
3. `docs/04-report/{feature}.report.md` 생성

### status
1. .bkit-memory.json 읽기
2. 현재 기능, PDCA 단계, Task 상태 표시

### next
1. 현재 PDCA 단계 확인
2. 다음 단계 가이드 및 명령어 제안

## Template References

각 action 실행 시 imports에서 로드된 템플릿 활용:
- Plan → plan.template.md
- Design → design.template.md
- Do → do.template.md (신규)
- Check → analysis.template.md
- Act → report.template.md

## Task Integration

```
Task 생성 패턴:
┌────────────────────────────────────────┐
│ [Plan] {feature}                       │
│   ↓ (blockedBy)                        │
│ [Design] {feature}                     │
│   ↓ (blockedBy)                        │
│ [Do] {feature}                         │
│   ↓ (blockedBy)                        │
│ [Check] {feature}                      │
│   ↓ (blockedBy, Check < 90%)           │
│ [Act-1] {feature}                      │
│   ↓ (blockedBy, 반복 시)               │
│ [Act-N] {feature}                      │
│   ↓ (Check >= 90%)                     │
│ [Report] {feature}                     │
└────────────────────────────────────────┘
```
```

### 4.2 Skill Orchestrator 모듈 설계

#### 4.2.1 모듈 구조

```javascript
// lib/skill-orchestrator.js

/**
 * Skill Orchestrator - Skills 유기적 동작 관리
 *
 * 역할:
 * 1. Skill frontmatter 파싱 및 확장 필드 처리
 * 2. Template imports 로드
 * 3. Task 자동 생성/업데이트
 * 4. PDCA 상태 자동 관리
 * 5. 다음 Skill/Agent 제안
 */

const fs = require('fs');
const path = require('path');
const importResolver = require('./import-resolver.js');
const {
  readBkitMemory,
  writeBkitMemory,
  parseYamlFrontmatter,
  PLUGIN_ROOT
} = require('./common.js');

/**
 * Skill 호출 전 오케스트레이션
 * @param {string} skillName - Skill 이름
 * @param {object} args - 인자 (action, feature 등)
 * @param {object} context - 실행 컨텍스트
 */
async function orchestrateSkillPre(skillName, args, context) {
  // 1. Skill frontmatter 로드
  const skillPath = path.join(PLUGIN_ROOT, 'skills', skillName, 'SKILL.md');
  const skillContent = fs.readFileSync(skillPath, 'utf8');
  const { frontmatter, body } = parseYamlFrontmatter(skillContent);

  // 2. 확장 필드 추출
  const config = {
    name: frontmatter.name,
    imports: frontmatter.imports || [],
    agent: frontmatter.agent,
    nextSkill: frontmatter['next-skill'],
    pdcaPhase: frontmatter['pdca-phase'],
    taskTemplate: frontmatter['task-template'],
    skillsPreload: frontmatter['skills_preload'] || []
  };

  // 3. Imports 로드
  let templates = [];
  if (config.imports.length > 0) {
    const { content, errors } = importResolver.processMarkdownWithImports(skillPath);
    if (errors.length === 0) {
      templates = content;
    }
  }

  // 4. Task 자동 생성 (task-template 필드가 있는 경우)
  let taskId = null;
  if (config.taskTemplate && args.feature) {
    taskId = await createTaskFromTemplate(config.taskTemplate, args.feature, config.pdcaPhase);
  }

  // 5. PDCA 상태 업데이트
  if (config.pdcaPhase && args.feature) {
    await updatePdcaStatus(args.feature, config.pdcaPhase, taskId);
  }

  // 6. 결과 반환
  return {
    config,
    templates,
    taskId,
    body
  };
}

/**
 * Skill 호출 후 오케스트레이션
 * @param {string} skillName - Skill 이름
 * @param {object} result - Skill 실행 결과
 * @param {object} context - 실행 컨텍스트
 */
async function orchestrateSkillPost(skillName, result, context) {
  const memory = readBkitMemory();
  const skillConfig = getSkillConfig(skillName);

  // 1. Task 상태 업데이트
  if (memory.taskMapping && memory.pdcaStatus?.phase) {
    const taskId = memory.taskMapping[memory.pdcaStatus.phase];
    if (taskId) {
      // Task 완료 처리 (외부에서 TaskUpdate 호출 필요)
      result.taskUpdate = { taskId, status: 'completed' };
    }
  }

  // 2. 다음 단계 제안 생성
  if (skillConfig.nextSkill) {
    result.suggestedAction = {
      type: 'skill',
      name: skillConfig.nextSkill,
      message: getNextStepMessage(skillConfig.nextSkill, memory)
    };
  }

  // 3. Agent 자동 제안 (PDCA 단계 기반)
  if (memory.pdcaStatus?.phase === 'do') {
    result.suggestedAgent = 'gap-detector';
    result.suggestedMessage = '구현이 완료되었습니다. Gap 분석을 실행하시겠습니까?';
  }

  return result;
}

/**
 * Task 템플릿 기반 Task 생성
 */
async function createTaskFromTemplate(template, feature, pdcaPhase) {
  const subject = template.replace('{feature}', feature);
  const memory = readBkitMemory();

  // blockedBy 계산
  const phaseOrder = ['plan', 'design', 'do', 'check', 'act'];
  const currentIndex = phaseOrder.indexOf(pdcaPhase);
  const previousPhase = currentIndex > 0 ? phaseOrder[currentIndex - 1] : null;
  const blockedBy = previousPhase && memory.taskMapping?.[previousPhase]
    ? [memory.taskMapping[previousPhase]]
    : [];

  // Task 생성 정보 반환 (실제 생성은 Claude가 TaskCreate 호출)
  return {
    subject,
    description: `PDCA ${pdcaPhase} phase for ${feature}`,
    blockedBy,
    pdcaPhase
  };
}

/**
 * PDCA 상태 업데이트
 */
async function updatePdcaStatus(feature, phase, taskId) {
  const memory = readBkitMemory();

  memory.currentFeature = feature;
  memory.pdcaStatus = memory.pdcaStatus || {};
  memory.pdcaStatus.phase = phase;
  memory.pdcaStatus.lastUpdated = new Date().toISOString();

  memory.taskMapping = memory.taskMapping || {};
  if (taskId) {
    memory.taskMapping[phase] = taskId;
  }

  // Skill 히스토리 추가
  memory.skillHistory = memory.skillHistory || [];
  memory.skillHistory.push({
    skill: 'pdca',
    action: phase,
    feature,
    timestamp: new Date().toISOString()
  });

  writeBkitMemory(memory);
}

module.exports = {
  orchestrateSkillPre,
  orchestrateSkillPost,
  createTaskFromTemplate,
  updatePdcaStatus
};
```

### 4.3 Level Skills 확장 설계

#### 4.3.1 starter Skill 확장

```yaml
# skills/starter/SKILL.md (수정)
---
name: starter
description: |
  Static web development skill for beginners and non-developers.
  Covers HTML/CSS/JavaScript and Next.js App Router basics.

  "init starter" 또는 "starter init"으로 프로젝트 초기화.

  Triggers: static website, portfolio, landing page, HTML CSS, beginner,
  init starter, starter init, 정적 웹, 포트폴리오, 초보자
argument-hint: "[init|guide|help]"
agent: starter-guide
allowed-tools:
  - Read
  - Write
  - Edit
  - Glob
  - Grep
  - WebSearch
  - WebFetch
user-invocable: true
imports:
  - ${PLUGIN_ROOT}/templates/design-starter.template.md
next-skill: phase-1-schema
pdca-phase: plan
---
```

#### 4.3.2 starter Skill Actions 추가

```markdown
## Actions

### init (프로젝트 초기화)
1. 프로젝트 디렉토리 구조 생성
2. package.json 생성 (Next.js 또는 Pure HTML)
3. CLAUDE.md 생성 (Level: Starter 명시)
4. docs/ 폴더 구조 생성
5. .bkit-memory.json 초기화

### guide (개발 가이드)
1. 현재 프로젝트 상태 분석
2. Starter 레벨에 맞는 다음 단계 제안
3. 관련 Phase Skill 로드

### help (초보자 도움말)
1. 기본 개념 설명
2. 자주 묻는 질문 답변
3. 예제 코드 제공
```

#### 4.3.3 dynamic/enterprise Skill 동일 패턴 적용

```yaml
# skills/dynamic/SKILL.md 확장
argument-hint: "[init|guide|help]"
imports:
  - ${PLUGIN_ROOT}/templates/design-dynamic.template.md
  - ${PLUGIN_ROOT}/templates/bkend-setup.md
next-skill: phase-1-schema
pdca-phase: plan
task-template: "[Init-Dynamic] {feature}"

# skills/enterprise/SKILL.md 확장
argument-hint: "[init|guide|help]"
imports:
  - ${PLUGIN_ROOT}/templates/design-enterprise.template.md
  - ${PLUGIN_ROOT}/templates/msa-setup.md
next-skill: phase-1-schema
pdca-phase: plan
task-template: "[Init-Enterprise] {feature}"
```

### 4.4 Phase Skills 확장 설계

#### 4.4.1 공통 확장 패턴

```yaml
# skills/phase-{N}-{name}/SKILL.md 공통 추가 필드
imports:
  - ${PLUGIN_ROOT}/templates/pipeline/phase-{N}.md
  - ${PLUGIN_ROOT}/templates/shared/naming-conventions.md
next-skill: phase-{N+1}-{next-name}
pdca-phase: do
task-template: "[Phase-{N}] {feature}"
```

#### 4.4.2 Phase 연결 맵

| Phase | Skill | next-skill | pdca-phase |
|-------|-------|------------|------------|
| 1 | phase-1-schema | phase-2-convention | plan |
| 2 | phase-2-convention | phase-3-mockup | plan |
| 3 | phase-3-mockup | phase-4-api | design |
| 4 | phase-4-api | phase-5-design-system | do |
| 5 | phase-5-design-system | phase-6-ui-integration | do |
| 6 | phase-6-ui-integration | phase-7-seo-security | do |
| 7 | phase-7-seo-security | phase-8-review | do |
| 8 | phase-8-review | phase-9-deployment | check |
| 9 | phase-9-deployment | null | act |

### 4.5 Stop Hooks 설계

#### 4.5.1 pdca-skill-stop.js

```javascript
// scripts/pdca-skill-stop.js
const {
  readStdinSync,
  readBkitMemory,
  writeBkitMemory,
  outputHookResult
} = require('../lib/common.js');

const input = readStdinSync();
const memory = readBkitMemory();

// PDCA 단계별 다음 액션 맵
const nextActionMap = {
  plan: { action: 'design', message: 'Plan 완료! Design 단계로 진행하시겠습니까?' },
  design: { action: 'do', message: 'Design 완료! 구현을 시작하시겠습니까?' },
  do: { agent: 'gap-detector', message: '구현 완료! Gap 분석을 실행하시겠습니까?' },
  check: {
    conditional: true,
    onLow: { agent: 'pdca-iterator', message: 'Match Rate < 90%. 자동 개선을 실행하시겠습니까?' },
    onHigh: { agent: 'report-generator', message: 'Match Rate >= 90%! 완료 보고서를 생성하시겠습니까?' }
  },
  act: { action: 'report', message: '개선 완료! 보고서를 생성하시겠습니까?' }
};

const currentPhase = memory.pdcaStatus?.phase;
const nextAction = nextActionMap[currentPhase];

if (nextAction) {
  const result = {
    continue: true,
    askUser: {
      question: nextAction.message,
      options: ['예, 진행합니다', '아니오, 나중에']
    }
  };

  if (nextAction.conditional) {
    // Check 단계의 조건부 처리는 gap-detector 결과에 따라
    result.conditional = nextAction;
  } else {
    result.suggestedAction = nextAction.agent
      ? { type: 'agent', name: nextAction.agent }
      : { type: 'skill', name: 'pdca', args: nextAction.action };
  }

  outputHookResult(result);
} else {
  outputHookResult({ continue: false });
}
```

#### 4.5.2 skill-post.js (일반 Skill용)

```javascript
// scripts/skill-post.js
const {
  readStdinSync,
  readBkitMemory,
  outputHookResult
} = require('../lib/common.js');

const input = readStdinSync();
const skillName = input.tool_input?.skill || input.skill;

// Skill 설정 로드
const skillConfig = loadSkillConfig(skillName);

const result = {
  continue: false
};

// next-skill이 있으면 제안
if (skillConfig.nextSkill) {
  result.continue = true;
  result.message = `${skillName} 완료. 다음 단계: ${skillConfig.nextSkill}`;
  result.suggestedAction = {
    type: 'skill',
    name: skillConfig.nextSkill
  };
}

outputHookResult(result);
```

---

## 5. File Changes Summary

### 5.1 신규 생성 파일

| File | Purpose | Priority |
|------|---------|----------|
| `skills/pdca/SKILL.md` | PDCA 통합 Skill | CRITICAL |
| `lib/skill-orchestrator.js` | Skill 오케스트레이션 | CRITICAL |
| `scripts/pdca-skill-stop.js` | PDCA Skill Stop Hook | CRITICAL |
| `scripts/skill-post.js` | 일반 Skill PostToolUse Hook | HIGH |
| `templates/do.template.md` | Do 단계 템플릿 | HIGH |
| `skills/claude-code-learning/SKILL.md` | Claude Code 학습 통합 Skill | MEDIUM |
| `skills/github-integration/SKILL.md` | GitHub 통합 Skill | MEDIUM |
| `scripts/phase5-design-stop.js` | Phase 5 Stop Hook | LOW |
| `scripts/phase6-ui-stop.js` | Phase 6 Stop Hook | LOW |
| `scripts/phase9-deploy-stop.js` | Phase 9 Stop Hook | LOW |

### 5.2 수정 파일

| File | Changes | Priority |
|------|---------|----------|
| `skills/starter/SKILL.md` | init action, imports, next-skill 추가 | HIGH |
| `skills/dynamic/SKILL.md` | init action, imports, next-skill 추가 | HIGH |
| `skills/enterprise/SKILL.md` | init action, imports, next-skill 추가 | HIGH |
| `skills/phase-*/SKILL.md` (9개) | imports, next-skill, pdca-phase 추가 | HIGH |
| `skills/development-pipeline/SKILL.md` | pipeline 관리 기능 확장 | MEDIUM |
| `skills/bkit-templates/SKILL.md` | archive 기능 추가 | MEDIUM |
| `agents/code-analyzer.md` | skills_preload 추가 | MEDIUM |
| `agents/pdca-iterator.md` | skills_preload 추가 | MEDIUM |
| `hooks/hooks.json` | PostToolUse(Skill) Hook 추가 | HIGH |
| `lib/import-resolver.js` | 확장 frontmatter 지원 | HIGH |
| `lib/common.js` | Skill orchestration 유틸리티 | HIGH |
| `plugin.json` | skills autoActivate 업데이트 | HIGH |
| `gemini-extension.json` | commands 비활성화, skills 업데이트 | HIGH |

### 5.3 Deprecation 처리

| File/Folder | Action | Timeline |
|-------------|--------|----------|
| `commands/*.md` (20개) | Deprecation notice 추가 | Phase 7 |
| `commands/gemini/*.toml` (20개) | Deprecation notice 추가 | Phase 7 |

---

## 6. Implementation Order

### 6.1 Phase 1: PDCA Skill 통합 (Day 1-2)

```
1. [ ] skills/pdca/SKILL.md 생성
2. [ ] templates/do.template.md 생성
3. [ ] scripts/pdca-skill-stop.js 생성
4. [ ] lib/skill-orchestrator.js 기본 구현
```

### 6.2 Phase 2: Templates-Skills 통합 (Day 2-3)

```
1. [ ] lib/import-resolver.js 확장
2. [ ] skills/phase-*/SKILL.md imports 추가 (9개)
3. [ ] skills/bkit-rules/SKILL.md imports 확인
```

### 6.3 Phase 3: Level Skills 확장 (Day 3-4)

```
1. [ ] skills/starter/SKILL.md 확장 (init action)
2. [ ] skills/dynamic/SKILL.md 확장 (init action)
3. [ ] skills/enterprise/SKILL.md 확장 (init action)
```

### 6.4 Phase 4: Agent-Skill 연동 (Day 4-5)

```
1. [ ] agents/code-analyzer.md skills_preload 추가
2. [ ] agents/pdca-iterator.md skills_preload 추가
3. [ ] agents/gap-detector.md skills_preload 확인
```

### 6.5 Phase 5: Skill Orchestrator 완성 (Day 5-6)

```
1. [ ] lib/skill-orchestrator.js 완성
2. [ ] hooks/hooks.json PostToolUse(Skill) 추가
3. [ ] scripts/skill-post.js 구현
```

### 6.6 Phase 6: Stop Hooks 추가 (Day 6-7)

```
1. [ ] scripts/phase5-design-stop.js
2. [ ] scripts/phase6-ui-stop.js
3. [ ] scripts/phase9-deploy-stop.js
```

### 6.7 Phase 7: Commands 제거 (Day 7)

```
1. [ ] commands/ 폴더 DEPRECATED.md 추가
2. [ ] gemini-extension.json commands 비활성화
3. [ ] 최종 테스트 및 회귀 테스트
```

---

## 7. Test Plan

### 7.1 Unit Tests

| Test | Verification |
|------|--------------|
| PDCA Skill frontmatter | YAML 파싱, 모든 필드 확인 |
| Skill Orchestrator | Task 생성, PDCA 상태 업데이트 |
| Import Resolver | 확장 필드 지원, 변수 치환 |
| Stop Hooks | 출력 형식, 다음 액션 제안 |

### 7.2 Integration Tests

| Scenario | Verification |
|----------|--------------|
| PDCA Full Cycle | plan → design → do → check → act 자동 흐름 |
| Pipeline Flow | Phase 1 → 9 next-skill 연결 |
| Level Init | starter/dynamic/enterprise init 동작 |
| Agent-Skill | Gap-detector → pdca-iterator 연동 |

### 7.3 Regression Tests

| Item | Verification |
|------|--------------|
| 기존 Skills | 모든 기존 Skill 정상 동작 |
| 기존 Agents | 모든 Agent 정상 동작 |
| Gemini CLI | 모든 기능 호환성 |

---

## 8. Success Criteria

| Criteria | Target | Measurement |
|----------|--------|-------------|
| Commands 제거 | 100% | 모든 기능 Skills로 동작 |
| Gap Score 개선 | 55% → 90%+ | Gap Analysis 재실행 |
| 유기적 동작 | 100% | Skill 호출 시 자동 연동 확인 |
| 회귀 테스트 | 100% | 모든 테스트 통과 |

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 0.1 | 2026-01-27 | Initial draft | Claude Opus 4.5 |
