# v1.4.4 Skills/Agents/Commands Enhancement Plan

> **작성일**: 2026-01-27
> **버전**: v1.4.4
> **기능명**: skills-agents-commands-enhancement
> **브랜치**: feature/v1.4.4-skills-agents-commands-enhancement

---

## 1. 개요

### 1.1 목적

bkit v1.4.4는 **Skills 중심 아키텍처**로 전환하여:
- Commands와 Skills의 이중 구조 제거
- Skills-Agents-Task의 유기적 연동 강화
- 설계 철학(Philosophy)의 완전한 구현

### 1.2 Gap 분석 기반

[v1.4.4-gap-analysis-10-perspectives.md](../03-analysis/v1.4.4-gap-analysis-10-perspectives.md) 참조

| Gap | 점수 | 우선순위 |
|-----|------|----------|
| Commands → Skills 전환 | 55/100 | CRITICAL |
| Templates-Skills 통합 | 55/100 | CRITICAL |
| Skills 유기적 동작 | 55/100 | CRITICAL |

### 1.3 핵심 원칙

```
1. Skills First: Commands 대신 Skills로 모든 기능 제공
2. Organic Integration: Skills-Agents-Task-Templates 자동 연동
3. Philosophy Compliance: Automation First, No Guessing, Docs=Code 완전 구현
4. Backward Compatible: 기존 Commands는 Skills로 리다이렉트
```

---

## 2. 아키텍처 변경

### 2.1 현재 아키텍처 (As-Is)

```
Commands (20개)  →  직접 실행
Skills (18개)    →  별도 실행
Agents (11개)    →  수동 호출
Templates (23개) →  수동 참조
Task System      →  일부 연동
```

### 2.2 목표 아키텍처 (To-Be)

```
Skills (통합, 확장)
    ↓
┌───────────────────────────────────────┐
│ Skill Orchestrator (신규)              │
│ - Template 자동 로드 (@import)         │
│ - Agent 자동 제안                      │
│ - Task 자동 생성/업데이트              │
│ - PDCA 상태 자동 관리                  │
│ - 다음 단계 자동 제안                   │
└───────────────────────────────────────┘
    ↓
Hooks (강화)
    ↓
유기적 워크플로우
```

### 2.3 Skill 카테고리 재구성

| 카테고리 | Skills | 기존 Commands 통합 |
|----------|--------|-------------------|
| **PDCA** | pdca (통합) | /pdca-plan, /pdca-design, /pdca-analyze, /pdca-iterate, /pdca-report, /pdca-status, /pdca-next |
| **Pipeline** | development-pipeline (확장) | /pipeline-start, /pipeline-next, /pipeline-status |
| **Level** | starter, dynamic, enterprise (확장) | /init-starter, /init-dynamic, /init-enterprise, /upgrade-level |
| **QA** | zero-script-qa | /zero-script-qa |
| **Archive** | bkit-templates (확장) | /archive |
| **Utility** | claude-code-learning (신규) | /learn-claude-code, /setup-claude-code, /upgrade-claude-code |
| **GitHub** | github-integration (신규) | /github-stats |
| **Phase 1-9** | phase-1~9 (유지) | 없음 |

---

## 3. 상세 구현 계획

### 3.1 Phase 1: PDCA Skill 통합 (CRITICAL)

#### 3.1.1 신규 Skill 생성: `skills/pdca/SKILL.md`

```yaml
---
name: pdca
description: |
  PDCA 사이클 전체를 관리하는 통합 skill.
  "계획", "설계", "분석", "보고서", "상태" 키워드로 자동 호출.
  기존 /pdca-* 명령어를 대체.
argument-hint: "[action] [feature]"
user-invocable: true
allowed-tools: Read, Write, Edit, Glob, Grep, Task, TaskCreate, TaskUpdate
imports:
  - ${PLUGIN_ROOT}/templates/plan.template.md
  - ${PLUGIN_ROOT}/templates/design.template.md
  - ${PLUGIN_ROOT}/templates/analysis.template.md
  - ${PLUGIN_ROOT}/templates/report.template.md
hooks:
  Stop:
    - type: command
      command: "node ${CLAUDE_PLUGIN_ROOT}/scripts/pdca-skill-stop.js"
---

# PDCA Skill

## Arguments
- `plan [feature]`: Plan 문서 생성
- `design [feature]`: Design 문서 생성
- `analyze [feature]`: Gap 분석 실행
- `iterate [feature]`: 자동 개선 반복
- `report [feature]`: 완료 보고서 생성
- `status`: 현재 PDCA 상태 표시
- `next`: 다음 단계 가이드

## Templates
위 imports에서 로드된 템플릿을 활용하여 문서 생성.

## Task Integration
각 action 실행 시 Task 자동 생성:
- [Plan] {feature}
- [Design] {feature} (blockedBy: Plan)
- [Check] {feature} (blockedBy: Do)
- [Act-N] {feature} (blockedBy: Check)
```

#### 3.1.2 기존 Commands 리다이렉트

```javascript
// commands/pdca-plan.md → skill 호출로 변경
// 또는 hooks.json에서 UserPromptSubmit으로 리다이렉트
```

#### 3.1.3 신규 Script: `scripts/pdca-skill-stop.js`

- PDCA 상태 업데이트
- 다음 단계 AskUserQuestion 생성
- Task 자동 업데이트

### 3.2 Phase 2: Templates-Skills 통합

#### 3.2.1 모든 Phase Skill에 @import 추가

```yaml
# skills/phase-1-schema/SKILL.md
---
name: phase-1-schema
imports:
  - ${PLUGIN_ROOT}/templates/pipeline/phase-1.md
  - ${PLUGIN_ROOT}/templates/shared/naming-conventions.md
next-skill: phase-2-convention
pdca-phase: plan
task-template: "[Schema] {feature}"
---
```

#### 3.2.2 Import Resolver 확장

```javascript
// lib/import-resolver.js 확장
// next-skill, pdca-phase, task-template 필드 파싱 지원
```

### 3.3 Phase 3: Level Skill 확장

#### 3.3.1 starter/dynamic/enterprise Skill에 init 기능 추가

```yaml
# skills/starter/SKILL.md
---
name: starter
description: |
  Starter 레벨 프로젝트 개발 가이드.
  "초보자", "정적 웹", "포트폴리오" 키워드로 자동 호출.
  "init starter" 또는 "starter init"으로 프로젝트 초기화.
argument-hint: "[init|guide|help]"
imports:
  - ${PLUGIN_ROOT}/templates/design-starter.template.md
---

## Actions
- `init`: 프로젝트 초기화 (/init-starter 기능)
- `guide`: 개발 가이드 표시
- `help`: 초보자 도움말
```

### 3.4 Phase 4: Agent-Skill 연동 강화

#### 3.4.1 Agent skills_preload 완성

| Agent | 추가할 skills_preload |
|-------|----------------------|
| code-analyzer | phase-2-convention |
| pdca-iterator | pdca |
| pipeline-guide | phase-1~9 (선택적) |

#### 3.4.2 Agent Stop Hook 통합

모든 Agent Stop 시:
1. Task 상태 업데이트
2. PDCA 상태 업데이트
3. 다음 Agent/Skill 제안

### 3.5 Phase 5: Skill Orchestrator 구현

#### 3.5.1 신규 모듈: `lib/skill-orchestrator.js`

```javascript
/**
 * Skill Orchestrator - Skills 유기적 동작 관리
 *
 * 기능:
 * - Skill 호출 시 관련 Template 자동 로드
 * - Skill 완료 시 다음 Skill 자동 제안
 * - Task 자동 생성/업데이트
 * - PDCA 상태 자동 관리
 */

const orchestrateSkill = async (skillName, args, context) => {
  // 1. Skill frontmatter 파싱
  const skillConfig = parseSkillFrontmatter(skillName);

  // 2. imports 로드
  const templates = await loadImports(skillConfig.imports);

  // 3. Task 자동 생성
  if (skillConfig.taskTemplate) {
    await createTask(skillConfig.taskTemplate, args.feature);
  }

  // 4. PDCA 상태 업데이트
  if (skillConfig.pdcaPhase) {
    await updatePdcaStatus(args.feature, skillConfig.pdcaPhase);
  }

  // 5. Context 반환
  return {
    templates,
    nextSkill: skillConfig.nextSkill,
    pdcaPhase: skillConfig.pdcaPhase
  };
};
```

#### 3.5.2 PostToolUse Hook 연동

```json
// hooks/hooks.json
{
  "PostToolUse": [
    {
      "matcher": "Skill",
      "hooks": [{
        "type": "command",
        "command": "node ${CLAUDE_PLUGIN_ROOT}/scripts/skill-post.js"
      }]
    }
  ]
}
```

### 3.6 Phase 6: 누락 Stop Hooks 추가

#### 3.6.1 신규 Scripts

| Script | 용도 |
|--------|------|
| phase5-design-stop.js | Phase 5 완료 → Phase 6 가이드 |
| phase6-ui-stop.js | Phase 6 완료 → Phase 7 가이드 |
| phase9-deploy-stop.js | Phase 9 완료 → 배포 완료 처리 |

### 3.7 Phase 7: Commands 제거 (최종)

#### 3.7.1 Commands 폴더 정리

```
commands/
├── DEPRECATED.md (마이그레이션 가이드)
└── gemini/
    └── DEPRECATED.md
```

#### 3.7.2 Gemini Extension 업데이트

```json
// gemini-extension.json
{
  "commands": {
    "directory": null  // commands 비활성화
  },
  "skills": {
    "directory": "skills",
    "autoActivate": ["bkit-rules", "development-pipeline", "pdca"]
  }
}
```

---

## 4. 파일 변경 목록

### 4.1 신규 생성

| 파일 | 용도 |
|------|------|
| `skills/pdca/SKILL.md` | PDCA 통합 Skill |
| `skills/claude-code-learning/SKILL.md` | Claude Code 학습 Skill |
| `skills/github-integration/SKILL.md` | GitHub 통합 Skill |
| `lib/skill-orchestrator.js` | Skill 유기적 동작 관리 |
| `scripts/pdca-skill-stop.js` | PDCA Skill Stop Hook |
| `scripts/skill-post.js` | Skill PostToolUse Hook |
| `scripts/phase5-design-stop.js` | Phase 5 Stop Hook |
| `scripts/phase6-ui-stop.js` | Phase 6 Stop Hook |
| `scripts/phase9-deploy-stop.js` | Phase 9 Stop Hook |
| `templates/do.template.md` | Do 단계 Template |

### 4.2 수정

| 파일 | 변경 내용 |
|------|----------|
| `skills/phase-*/SKILL.md` (9개) | imports, next-skill 추가 |
| `skills/starter/SKILL.md` | init 기능 추가 |
| `skills/dynamic/SKILL.md` | init 기능 추가 |
| `skills/enterprise/SKILL.md` | init 기능 추가 |
| `skills/development-pipeline/SKILL.md` | pipeline 관리 기능 추가 |
| `skills/bkit-templates/SKILL.md` | archive 기능 추가 |
| `agents/code-analyzer.md` | skills_preload 추가 |
| `agents/pdca-iterator.md` | skills_preload 추가 |
| `hooks/hooks.json` | PostToolUse(Skill) Hook 추가 |
| `lib/import-resolver.js` | 확장 frontmatter 지원 |
| `lib/common.js` | Skill orchestration 유틸리티 |
| `hooks/session-start.js` | Level별 Skill 자동 제안 |
| `plugin.json` | skills autoActivate 업데이트 |
| `gemini-extension.json` | commands 비활성화 |

### 4.3 삭제 (Phase 7)

| 파일 | 사유 |
|------|------|
| `commands/*.md` (20개) | Skills로 통합 |
| `commands/gemini/*.toml` (20개) | Skills로 통합 |

---

## 5. 테스트 계획

### 5.1 단위 테스트

| 테스트 | 검증 항목 |
|--------|----------|
| Skill Import | Template 로드 확인 |
| Skill Orchestrator | 자동 Task 생성 확인 |
| PDCA Skill | 모든 action 동작 확인 |
| Level Skill | init 기능 동작 확인 |

### 5.2 통합 테스트

| 시나리오 | 검증 항목 |
|----------|----------|
| PDCA Cycle | Plan → Design → Do → Check → Act 자동 흐름 |
| Pipeline Flow | Phase 1 → 9 순차 진행 |
| Level Auto-trigger | Starter/Dynamic/Enterprise 자동 감지 및 Skill 제안 |

### 5.3 회귀 테스트

| 항목 | 검증 |
|------|------|
| 기존 Commands | Skill로 리다이렉트 동작 |
| Gemini CLI 호환성 | 모든 Skill 정상 동작 |

---

## 6. 마일스톤

| 단계 | 기간 | 산출물 |
|------|------|--------|
| Phase 1 | Day 1-2 | PDCA Skill 통합 완료 |
| Phase 2 | Day 2-3 | Templates-Skills 통합 완료 |
| Phase 3 | Day 3-4 | Level Skill 확장 완료 |
| Phase 4 | Day 4-5 | Agent-Skill 연동 완료 |
| Phase 5 | Day 5-6 | Skill Orchestrator 구현 |
| Phase 6 | Day 6-7 | Stop Hooks 추가 |
| Phase 7 | Day 7 | Commands 제거 및 최종 테스트 |

---

## 7. 위험 요소 및 대응

| 위험 | 영향 | 대응 |
|------|------|------|
| Commands 제거 시 호환성 깨짐 | HIGH | Phase 7까지 리다이렉트 유지 |
| Skill Orchestrator 복잡도 | MEDIUM | 단계적 기능 추가 |
| Gemini CLI 호환성 | MEDIUM | 별도 테스트 브랜치 |

---

## 8. 성공 기준

1. **Commands 완전 제거**: 모든 기능이 Skills로 동작
2. **Gap 점수 90% 이상**: 현재 55% → 90%
3. **유기적 동작**: Skill 호출 시 Template, Task, PDCA 자동 연동
4. **회귀 테스트 통과**: 모든 기존 기능 정상 동작

---

*Plan 작성 완료: 2026-01-27*
*다음 단계: /pdca-design v1.4.4-skills-agents-commands-enhancement*
